//
//  ButtonCloudTableViewCell.swift
//  Breathe
//
//  Created by Ian Kohlert on 2018-02-02.
//  Copyright Â© 2018 aestusLabs. All rights reserved.
//

import UIKit

class ButtonCloudTableViewCell: UITableViewCell {
    @IBOutlet weak var spacerView: UIView!
    
    @IBOutlet weak var row1Button1: UIButton!
    @IBOutlet weak var row1Button1Width: NSLayoutConstraint!
    @IBOutlet weak var row1Button1Center: NSLayoutConstraint!
    
    
    
    @IBOutlet weak var row1Button2: UIButton!
    @IBOutlet weak var row1Button2Width: NSLayoutConstraint!
    @IBOutlet weak var row1Button2Center: NSLayoutConstraint!
    
    
    
    
    @IBOutlet weak var row1Button3: UIButton!
    @IBOutlet weak var row1Button3Width: NSLayoutConstraint!
    
    @IBOutlet weak var row1Button3Center: NSLayoutConstraint!
    
    
    @IBOutlet weak var row1Button4: UIButton!
    @IBOutlet weak var row1Button4Width: NSLayoutConstraint!
    
    @IBOutlet weak var row1Button4Center: NSLayoutConstraint!
    
    //---------------------------------------------------------------
    
    @IBOutlet weak var row2Button1: UIButton!
    @IBOutlet weak var row2Button1Width: NSLayoutConstraint!
    
    @IBOutlet weak var row2Button1Center: NSLayoutConstraint!
    
    
    
    @IBOutlet weak var row2Button2: UIButton!
    @IBOutlet weak var row2Button2Width: NSLayoutConstraint!
    
    @IBOutlet weak var row2Button2Center: NSLayoutConstraint!
    
    
    
    @IBOutlet weak var row2Button3: UIButton!
    @IBOutlet weak var row2Button3Width: NSLayoutConstraint!
    
    @IBOutlet weak var row2Button3Center: NSLayoutConstraint!
    
    
    
    @IBOutlet weak var row2Button4: UIButton!
    @IBOutlet weak var row2Button4Width: NSLayoutConstraint!
    
    @IBOutlet weak var row2Button4Center: NSLayoutConstraint!
    
    
    //---------------------------------------------------------------
    
    @IBOutlet weak var row3Button1: UIButton!
    @IBOutlet weak var row3Button1Width: NSLayoutConstraint!
    
    @IBOutlet weak var row3Button1Center: NSLayoutConstraint!
    
    
    
    @IBOutlet weak var row3Button2: UIButton!
    @IBOutlet weak var row3Button2Width: NSLayoutConstraint!
    
    @IBOutlet weak var row3Button2Center: NSLayoutConstraint!
    
    
    @IBOutlet weak var row3Button3: UIButton!
    @IBOutlet weak var row3Button3Width: NSLayoutConstraint!
    
    
    @IBOutlet weak var row3Button3Center: NSLayoutConstraint!
    
    
    @IBOutlet weak var row3Button4: UIButton!
    @IBOutlet weak var row3Button4Width: NSLayoutConstraint!
    
    @IBOutlet weak var row3Button4Center: NSLayoutConstraint!
    
    
    //---------------------------------------------------------------
    
    
    @IBOutlet weak var row4Button1: UIButton!
    
    @IBOutlet weak var row4Button1Height: NSLayoutConstraint!
    
    @IBOutlet weak var row4Button1Width: NSLayoutConstraint!
    
    @IBOutlet weak var row4Button1Center: NSLayoutConstraint!
    
    
    
    @IBOutlet weak var row4Button2: UIButton!
    
    @IBOutlet weak var row4Button2Width: NSLayoutConstraint!
    
    @IBOutlet weak var row4Button2Center: NSLayoutConstraint!
    
    
    
    @IBOutlet weak var row4Button3: UIButton!
    @IBOutlet weak var row4Button3Width: NSLayoutConstraint!
    
    @IBOutlet weak var row4Button3Center: NSLayoutConstraint!
    
    
    
    @IBOutlet weak var row4Button4: UIButton!
    
    @IBOutlet weak var row4Button4Width: NSLayoutConstraint!
    
    @IBOutlet weak var row4Button4Center: NSLayoutConstraint!
    
    
    // ----
    
    @IBOutlet weak var row5Button1: UIButton!
    @IBOutlet weak var row5Button1Width: NSLayoutConstraint!
    @IBOutlet weak var row5Button1Center: NSLayoutConstraint!
    
    @IBOutlet weak var row5Button2: UIButton!
    @IBOutlet weak var row5Button2Width: NSLayoutConstraint!
    @IBOutlet weak var row5Button2Center: NSLayoutConstraint!
    
    @IBOutlet weak var row5Button3: UIButton!
    @IBOutlet weak var row5Button3Width: NSLayoutConstraint!
    @IBOutlet weak var row5Button3Center: NSLayoutConstraint!
    
    @IBOutlet weak var row5Button4: UIButton!
    @IBOutlet weak var row5Button4Width: NSLayoutConstraint!
    @IBOutlet weak var row5Button4Center: NSLayoutConstraint!
    
   //---------------------------------------------------------------
    
    @IBOutlet weak var row6Button1: UIButton!
    @IBOutlet weak var row6Button1Width: NSLayoutConstraint!
    @IBOutlet weak var row6Button1Center: NSLayoutConstraint!
    
    
    
    @IBOutlet weak var row6Button2: UIButton!
    @IBOutlet weak var row6Button2Width: NSLayoutConstraint!
    @IBOutlet weak var row6Button2Center: NSLayoutConstraint!
    
    
    
    @IBOutlet weak var row6Button3: UIButton!
    @IBOutlet weak var row6Button3Width: NSLayoutConstraint!
    @IBOutlet weak var row6Button3Center: NSLayoutConstraint!
    
    
    
    @IBOutlet weak var row6Button4: UIButton!
    @IBOutlet weak var row6Button4Width: NSLayoutConstraint!
    @IBOutlet weak var row6Button4Center: NSLayoutConstraint!
    
    
    
    // ---------------------------------------------------------------
    @IBOutlet weak var row7Button1: UIButton!
    
    @IBOutlet weak var row7Button1Width: NSLayoutConstraint!
    
    @IBOutlet weak var row7Button1Center: NSLayoutConstraint!
    
    @IBOutlet weak var row7Button2: UIButton!
    @IBOutlet weak var row7Button2Width: NSLayoutConstraint!
    @IBOutlet weak var row7Button2Center: NSLayoutConstraint!
    
    @IBOutlet weak var row7Button3: UIButton!
    
    @IBOutlet weak var row7Button3Width: NSLayoutConstraint!
    
    @IBOutlet weak var row7Button3Center: NSLayoutConstraint!
    
    @IBOutlet weak var row7Button4: UIButton!
    
    @IBOutlet weak var row7Button4Width: NSLayoutConstraint!
    
    @IBOutlet weak var row7Button4Center: NSLayoutConstraint!
    
    // ---------------------------------------------------------------
    @IBOutlet weak var row8Button1: UIButton!
    
    @IBOutlet weak var row8Button1Width: NSLayoutConstraint!
    
    @IBOutlet weak var row8Button1Center: NSLayoutConstraint!
    
    @IBOutlet weak var row8Button2: UIButton!
    
    @IBOutlet weak var row8Button2Width: NSLayoutConstraint!
    
    
    @IBOutlet weak var Row8Button2Center: NSLayoutConstraint!
    
    @IBOutlet weak var row8Button3: UIButton!
    
    @IBOutlet weak var row8Button3Width: NSLayoutConstraint!
    
    @IBOutlet weak var row8Button3Center: NSLayoutConstraint!
    
    
    
    @IBOutlet weak var row8Button4: UIButton!
    
    @IBOutlet weak var row8Button4Width: NSLayoutConstraint!
    
    @IBOutlet weak var row8Button4Center: NSLayoutConstraint!
    
    
    
    
    
    // ---------------------------------------------------------------
    
    @IBOutlet weak var row1: UIView!
    
    @IBOutlet weak var row2: UIView!
    
    @IBOutlet weak var row3: UIView!
    
    @IBOutlet weak var row4: UIView!
    
    @IBOutlet weak var row5: UIView!
    
    @IBOutlet weak var row6: UIView!
    
    @IBOutlet weak var row7: UIView!
    
    @IBOutlet weak var row8: UIView!
    
    
    
    @IBOutlet weak var row1Height: NSLayoutConstraint!
    
    @IBOutlet weak var row2Height: NSLayoutConstraint!
    
    
    @IBOutlet weak var row3Height: NSLayoutConstraint!
    
    @IBOutlet weak var row4Height: NSLayoutConstraint!
    
    @IBOutlet weak var row5Height: NSLayoutConstraint!
    
    @IBOutlet weak var row6Height: NSLayoutConstraint!
    
    @IBOutlet weak var row7Height: NSLayoutConstraint!
    
    @IBOutlet weak var row8Height: NSLayoutConstraint!
    
    
    @IBOutlet weak var spacerHeight: NSLayoutConstraint!
    
    @IBOutlet weak var row1CenterX: NSLayoutConstraint!
    
    @IBOutlet weak var row2CenterX: NSLayoutConstraint!
    
    @IBOutlet weak var row3CenterX: NSLayoutConstraint!
    
    @IBOutlet weak var row4CenterX: NSLayoutConstraint!
    
    @IBOutlet weak var row5CenterX: NSLayoutConstraint!
    
    @IBOutlet weak var row6CenterX: NSLayoutConstraint!
    
    @IBOutlet weak var row7CenterX: NSLayoutConstraint!
    
    @IBOutlet weak var row8CenterX: NSLayoutConstraint!
    
    
    @IBOutlet weak var row2CenterY: NSLayoutConstraint!
    
    @IBOutlet weak var row3CenterY: NSLayoutConstraint!
    
    @IBOutlet weak var row4CenterY: NSLayoutConstraint!
    
    @IBOutlet weak var row5CenterY: NSLayoutConstraint!
    
    @IBOutlet weak var row6CenterY: NSLayoutConstraint!
    
    @IBOutlet weak var row7CenterY: NSLayoutConstraint!
    
    @IBOutlet weak var row8CenterY: NSLayoutConstraint!
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    // NOTE When I'm doing the suggestions and adding/subtracting I might need to set a height constraint for lin 2-4 buttons and set that to 0, now I'm just removing them from superview
    
    
    //---------------------------------------------------------------
//    User Message
    
    @IBOutlet weak var userMessageBackground: UIView!
    
    @IBOutlet weak var userMessageLabel: UILabel!
    
    @IBOutlet weak var userMessageCircle: UIView!
    
    @IBOutlet weak var userMessageCircleTrailing: NSLayoutConstraint!
    ////
    
    
    
    var shownButtons: [UIButton] = []
    var shownButtonsCenterYConstraints: [NSLayoutConstraint] = []
    var animate = false
    
    
//    var titles: [String] =  ["Deep Breathing", "Shining Skull Breath", "Bellows Breath", "Calming Breath", "Counted Breath", "Alternate Nostril Breathing"]
//    var actions: [ButtonAction] = [.colourThemeAction, .selectExercise, .selectExercise, .darkMode, .lengthInCycles, .email]
    var buttons: [ButtonData] = [] //[(title: String, action: ButtonAction)] = []
    var suggestionButtonsToCreate: [ButtonData] = []//[(title: String, action: ButtonAction)] = []
    var positionInItemsShown = 0
    var currentPromptType: PromptType? = nil
    
    var buttonTapped = false /// This is just used to set the alpha of buttons after a buttons is tapped while showing buttons
    
   // var dataForButtons: [(title: String, action: ButtonAction, userInputButton: Bool, globalButton: Bool, premiumButton: Bool)] = []
    
    var buttonsData: [ButtonData] = []
    
    var messageText = ""

    override func awakeFromNib() {
        super.awakeFromNib()

            let buttons = self.getAllButtons()
            for button in buttons {
                button.setTitleColor(.white, for: .normal)
                button.backgroundColor = getColourFor.appColour()
                button.layer.cornerRadius = 18
                button.titleLabel?.font = UIFont.systemFont(ofSize: 16, weight: UIFont.Weight.bold)
            }
        
        let yConstraints = [row2CenterY, row3CenterY, row4CenterY, row5CenterY, row6CenterY, row7CenterY, row8CenterY]
        
        
        var count: CGFloat = 1
        for constraint in yConstraints {
            constraint?.constant = 0
            count += 1
        }
       
        setUpUserMessage()
//        setColours()
  
    }

    func setColours() {
        var count = 0
        for button in shownButtons {
            // makes max sizes buttons fit
//            button.titleLabel?.adjustsFontSizeToFitWidth = true
            
            if buttons[count].premium && user.premium == false {
                button.backgroundColor = getColourFor.premiumButton()
                button.setTitleColor(getColourFor.label(), for: .normal)
            } else if buttons[count].global {
                button.backgroundColor = getColourFor.globalButton()
                button.setTitleColor(UIColor.white, for: .normal)
//                button.setTitleColor(getColourFor.label(), for: .normal)
            } else {
                button.backgroundColor = getColourFor.regularButton()
//                button.setTitleColor(getColourFor.label(), for: .normal)
    
            }
            count += 1
        }
    }
    
    
    func setUpUserMessage() {
        // MARK: Temp Set up user message
        userMessageBackground.layer.cornerRadius = 16
        userMessageBackground.layer.maskedCorners = [.layerMinXMinYCorner, .layerMinXMaxYCorner]
        userMessageBackground.backgroundColor = getColourFor.appColour()
        userMessageLabel.font = UIFont.systemFont(ofSize: 17, weight: .semibold)
        userMessageLabel.textColor = .white
        
        userMessageCircle.layer.cornerRadius = 12.5
        userMessageCircle.backgroundColor = .white
        
        userMessageLabel.text = messageText
        userMessageBackground.isHidden = true
//        userMessageLabel.sizeToFit()
        
    }
    
    
    func displayUserMessage() {
        displayInUserMessageMode(animate: false)
//        userMessageBackground.isHidden = false
//        userMessageLabel.text = messageText
//
//        let allButtons = getAllButtons()
//        for button in allButtons {
//            button.removeFromSuperview()
//        }
//
//       row2Height.constant = 0
//        row3Height.constant = 0
//        row4Height.constant = 0
//        row5Height.constant = 0
//        row6Height.constant = 0
//        row7Height.constant = 0
//        row8Height.constant = 0
//        spacerHeight.constant = 75
        
    }
 
    
    override func setSelected(_ selected: Bool, animated: Bool) {
        super.setSelected(selected, animated: animated)

        // Configure the view for the selected state
    }
    
    
 
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    func setUpAndAddButtons() {
   
        self.displayButtonsWith(titles: getButtonTitles())
        
        if chatManager.currentVC == .chat {
            setColours()
        } else {
            for button in shownButtons {
                button.backgroundColor = getColourFor.regularButton()
            }
        }
    }
        private func getButtonTitles() -> [String] {
            var titles: [String] = []
            for item in buttons {  // dataForButtons
                titles.append(item.title)
            }
//            print(titles)
            
            return titles
        }
    
    
        private func displayButtonsWith(titles: [String]) {
            
            //displayButtonsWith(titles: [String]) {
            var widths: [CGFloat] = []
            var widthsPerLine: [[CGFloat]] = [[],[],[],[], [],[], [], []]
            
            reduceWidthOfAllButtonsToZero()
          
            
            // Gets widths for titles of buttons
            for title in titles {
                widths.append(calculateWidthOfButtonFor(title: title))
            }
            
            widthsPerLine = figureOutWhichLineButtonsWillBeOn(widths: widths)
            moveRowsCenterY(widthsPerLine: widthsPerLine)
            
            createButtons(widthsPerLine: widthsPerLine, titles: titles)
            
//            removeUnusedRows(widthsPerLine: widthsPerLine)
            
 
            
            // moved chatVC buttons to vc file
            if chatManager.currentVC == .home {
//                addTapsToButtons()
            }
            
        }
    
    private func moveRowsCenterY(widthsPerLine: [[CGFloat]]) {
//        print("!!!!!! widthsPerLine ButtonCloudCell File")
//        print(widthsPerLine)
        
        if widthsPerLine[7].isEmpty {
            row8CenterY.constant = 264
            row7CenterY.constant = 264
            row6CenterY.constant = 220
            row5CenterY.constant = 176
            row4CenterY.constant = 132
            row3CenterY.constant = 88
            row2CenterY.constant = 44
        } else {
            row8CenterY.constant = 308
            row7CenterY.constant = 264
            row6CenterY.constant = 220
            row5CenterY.constant = 176
            row4CenterY.constant = 132
            row3CenterY.constant = 88
            row2CenterY.constant = 44
        }
        if widthsPerLine[6].isEmpty {
            row8CenterY.constant = 220
            row7CenterY.constant = 220
            row6CenterY.constant = 220
            row5CenterY.constant = 176
            row4CenterY.constant = 132
            row3CenterY.constant = 88
            row2CenterY.constant = 44
            
        }
        if widthsPerLine[5].isEmpty {
            row8CenterY.constant = 176
            row7CenterY.constant = 176
            row6CenterY.constant = 176
            row5CenterY.constant = 176
            row4CenterY.constant = 132
            row3CenterY.constant = 88
            row2CenterY.constant = 44
        }
        
        if widthsPerLine[4].isEmpty {
            row8CenterY.constant = 132
            row7CenterY.constant = 132
            row6CenterY.constant = 132
            row5CenterY.constant = 132
            row4CenterY.constant = 132
            row3CenterY.constant = 88
            row2CenterY.constant = 44

        }
        if widthsPerLine[3].isEmpty {
            row8CenterY.constant = 88
            row7CenterY.constant = 88
            row6CenterY.constant = 88
            row5CenterY.constant = 88
            row4CenterY.constant = 88
            row3CenterY.constant = 88
            row2CenterY.constant = 44

        }
        
        if widthsPerLine[2].isEmpty {
            row8CenterY.constant = 44
            row7CenterY.constant = 44
            row6CenterY.constant = 44
            row5CenterY.constant = 44
            row4CenterY.constant = 44
            row3CenterY.constant = 44
            row2CenterY.constant = 44
        }
        
        if widthsPerLine[1].isEmpty {
            row8CenterY.constant = 0
            row7CenterY.constant = 0
            row6CenterY.constant = 0
            row5CenterY.constant = 0
            row4CenterY.constant = 0
            row3CenterY.constant = 0
            row2CenterY.constant = 0
        }
//        print(row2CenterY.constant, row3CenterY.constant, row4CenterY.constant, row5CenterY.constant, row5CenterY.constant, row6CenterY.constant, row7CenterY.constant, row8CenterY.constant)
        
//        self.layoutIfNeeded()
    }
    
    
            private func reduceWidthOfAllButtonsToZero() {
                let row1WidthConstraints = [row1Button1Width, row1Button2Width, row1Button3Width, row1Button4Width]
                let row2WidthConstraints = [row2Button1Width, row2Button2Width, row2Button3Width, row2Button4Width]
                let row3WidthConstraints = [row3Button1Width, row3Button2Width, row3Button3Width, row3Button4Width]
                let row4WidthConstraints = [row4Button1Width,row4Button2Width, row4Button3Width, row4Button4Width]
                let row5WidthConstraints = [row5Button1Width, row5Button2Width, row5Button3Width, row5Button4Width]
                let row6WidthConstraints = [row6Button1Width, row6Button2Width, row6Button3Width, row6Button4Width]
                let row7WidthConstraints = [row7Button1Width, row7Button2Width, row7Button3Width, row7Button4Width]
                let row8WidthConstraints = [row8Button1Width, row8Button2Width, row8Button3Width, row8Button4Width]
                
                let arrayOfRowsOfWidthConstraints = [row1WidthConstraints, row2WidthConstraints, row3WidthConstraints, row4WidthConstraints, row5WidthConstraints, row6WidthConstraints, row7WidthConstraints, row8WidthConstraints]
                for row in arrayOfRowsOfWidthConstraints {
                    for widthConstraint in row {
                        widthConstraint?.constant = 0
                    }
                }
            }
    
    
    
    
    
            private func figureOutWhichLineButtonsWillBeOn(widths: [CGFloat] ) -> [[CGFloat]]{
                var widthsPerLine: [[CGFloat]] = [[],[],[],[], [],[], [], []]
                let cellWidth = UIScreen.main.bounds.width //self.frame.width
//                print(cellWidth)
                
                var lineCount = 0
                for width in widths {
                    
                    var currentLineWidth: CGFloat = 0
                    for w in widthsPerLine[lineCount] {
                        currentLineWidth += w
                    }
                
                    if width + currentLineWidth <= cellWidth - 16 && widthsPerLine[lineCount].count <= 4{
                        
                        widthsPerLine[lineCount].append(width)

                        if widthsPerLine[lineCount].count == 4 {
                            lineCount += 1
                        }
                    } else {
                        lineCount += 1
                        widthsPerLine[lineCount].append(width)
                    }
                }
//                print(widthsPerLine)
                
                return widthsPerLine
            }
    
    
    
            private func removeUnusedRows(widthsPerLine: [[CGFloat]]) {
                
               // let row1Buttons = [row1Button1, row1Button2, row1Button3, row1Button4]
                let row2Buttons = [row2Button1, row2Button2, row2Button3, row2Button4] // [row2Button4, row2Button3, row2Button2, row2Button1] //
                let row3Buttons = [row3Button1,row3Button2, row3Button3, row3Button4]
                let row4Buttons =  [row4Button1, row4Button2, row4Button3, row4Button4]
                let row5Buttons = [row5Button1, row5Button2, row5Button3, row5Button4]
                let row6Buttons = [row6Button1, row6Button2, row6Button3, row6Button4]
                let row7Buttons = [ row7Button1, row7Button2, row7Button3, row7Button4]
                let row8Buttons = [ row8Button1, row8Button2, row8Button3, row8Button4]
                
        
                
                
                if widthsPerLine[7].isEmpty {
                    row8Height.constant = 0
                    //            spacerHeight.constant = 8 + 8 + (7 * 44)
                    
                    for button in row8Buttons {
                        button?.removeFromSuperview()
                    }
                    
                }
                
                if widthsPerLine[6].isEmpty {
                    row7Height.constant = 0
                    //            spacerHeight.constant = 8 + 8 + (6 * 44)
                    
                    for button in row7Buttons {
                        button?.removeFromSuperview()
                    }
                    
                }
                
                
                if widthsPerLine[5].isEmpty {
                    row6Height.constant = 0
                    //            spacerHeight.constant = 8 + 8 + (5 * 44)
                    
                    for button in row6Buttons {
                        button?.removeFromSuperview()
                    }
                    
                }
                if widthsPerLine[4].isEmpty {
                    row5Height.constant = 0
                    //            spacerHeight.constant = 8 + 8 + (4 * 44) // 160
                    
                    
                    
                    for button in row5Buttons {
                        button?.removeFromSuperview()
                    }
                    
                }
                
                if widthsPerLine[3].isEmpty {
                    row4Height.constant = 0
                    //            spacerHeight.constant = 8 + 8 + (3 * 44) //122
                    
                    
                    
                    for button in row4Buttons {
                        button?.removeFromSuperview()
                    }
                    //            row4Button1Height.constant = 0
                    
                }
                if widthsPerLine[2].isEmpty {
                    row3Height.constant = 0
                    //            spacerHeight.constant = 8 + 8 + (2 * 44) //84
                    for button in row3Buttons {
                        button?.removeFromSuperview()
                    }
                }
                if widthsPerLine[1].isEmpty {
                    row2Height.constant = 0
                    //            spacerHeight.constant = 8 + 8 + (1 * 44) //46
                    for button in row2Buttons {
                        button?.removeFromSuperview()
                    }
                }
            }
    
    
    
          private func createButtons(widthsPerLine: [[CGFloat]], titles: [String]) {
            
                shownButtons = [] // to stop from doubling up when user message expandeded
                
                var row1Buttons = [row1Button1, row1Button2, row1Button3, row1Button4]
                var row2Buttons = [row2Button1, row2Button2, row2Button3, row2Button4] // [row2Button4, row2Button3, row2Button2, row2Button1] //
                var row3Buttons = [row3Button1,row3Button2, row3Button3, row3Button4]
                var row4Buttons =  [row4Button1, row4Button2, row4Button3, row4Button4]
                var row5Buttons = [row5Button1, row5Button2, row5Button3, row5Button4]
                var row6Buttons = [row6Button1, row6Button2, row6Button3, row6Button4]
                var row7Buttons = [ row7Button1, row7Button2, row7Button3, row7Button4]
                var row8Buttons = [ row8Button1, row8Button2, row8Button3, row8Button4]
                
                var row1WidthConstraints = [row1Button1Width, row1Button2Width, row1Button3Width, row1Button4Width]
                var row2WidthConstraints = [row2Button1Width, row2Button2Width, row2Button3Width, row2Button4Width]
                var row3WidthConstraints = [row3Button1Width, row3Button2Width, row3Button3Width, row3Button4Width]
                var row4WidthConstraints = [row4Button1Width,row4Button2Width, row4Button3Width, row4Button4Width]
                var row5WidthConstraints = [row5Button1Width, row5Button2Width, row5Button3Width, row5Button4Width]
                var row6WidthConstraints = [row6Button1Width, row6Button2Width, row6Button3Width, row6Button4Width]
                var row7WidthConstraints = [row7Button1Width, row7Button2Width, row7Button3Width, row7Button4Width]
                var row8WidthConstraints = [row8Button1Width, row8Button2Width, row8Button3Width, row8Button4Width]
                
                let row1CenterConstraints = getRow1CenterConstraints()
                let row2CenterConstraints = getRow2CenterConstraints()
                let row3CenterConstraints = getRow3CenterConstraints()
                let row4CenterConstraints = getRow4CenterConstraints()
                let row5CenterConstraints = getRow5CenterConstraints()
                let row6CenterConstraints = getRow6CenterConstraints()
                let row7CenterConstraints = getRow7CenterConstraints()
                let row8CenterConstraints = getRow8CenterConstraints()
                
                var count = 0
                var titleCount = 0
                for width in widthsPerLine[0] {
                    row1WidthConstraints[count]?.constant = width
                    row1Buttons[count]?.setTitle(titles[titleCount], for: .normal)
                    shownButtons.append(row1Buttons[count]!)
                    shownButtonsCenterYConstraints.append(row1CenterConstraints[count])
                    titleCount += 1
                    count += 1
                }
                count = 0
                
                for width in widthsPerLine[1] {
                    
                    row2WidthConstraints[count]?.constant = width
                    row2Buttons[count]?.setTitle(titles[titleCount], for: .normal)
                    shownButtons.append(row2Buttons[count]!)
                    shownButtonsCenterYConstraints.append(row2CenterConstraints[count])
                    titleCount += 1
                    count += 1
                }
                count = 0
                for width in widthsPerLine[2] {
                    row3WidthConstraints[count]?.constant = width
                    row3Buttons[count]?.setTitle(titles[titleCount], for: .normal)
                    shownButtons.append(row3Buttons[count]!)
                    shownButtonsCenterYConstraints.append(row3CenterConstraints[count])
                    titleCount += 1
                    count += 1
                }
                count = 0
                for width in widthsPerLine[3] {
                    row4WidthConstraints[count]?.constant = width
                    
                    row4Buttons[count]?.setTitle(titles[titleCount], for: .normal)
                    shownButtons.append(row4Buttons[count]!)
                    shownButtonsCenterYConstraints.append(row4CenterConstraints[count])
                    titleCount += 1
                    count += 1
                }
                
                count = 0
                for width in widthsPerLine[4] {
                    row5WidthConstraints[count]?.constant = width
                    row5Buttons[count]?.setTitle(titles[titleCount], for: .normal)
                    shownButtons.append(row5Buttons[count]!)
                    shownButtonsCenterYConstraints.append(row5CenterConstraints[count])
                    titleCount += 1
                    count += 1
                }
                
                
                count = 0
                for width in widthsPerLine[5] {
                    row6WidthConstraints[count]?.constant = width
                    row6Buttons[count]?.setTitle(titles[titleCount], for: .normal)
                    shownButtons.append(row6Buttons[count]!)
                    shownButtonsCenterYConstraints.append(row6CenterConstraints[count])
                    titleCount += 1
                    count += 1
                }
                
                count = 0
                for width in widthsPerLine[6] {
                    row7WidthConstraints[count]?.constant = width
                    row7Buttons[count]?.setTitle(titles[titleCount], for: .normal)
                    shownButtons.append(row7Buttons[count]!)
                    shownButtonsCenterYConstraints.append(row7CenterConstraints[count])
                    titleCount += 1
                    count += 1
                }
                
                count = 0
                for width in widthsPerLine[7] {
                    row8WidthConstraints[count]?.constant = width
                    row8Buttons[count]?.setTitle(titles[titleCount], for: .normal)
                    shownButtons.append(row8Buttons[count]!)
                    shownButtonsCenterYConstraints.append(row8CenterConstraints[count])
                    titleCount += 1
                    count += 1
                }
            }
    
    
    
//            private func addTapsToButtons() {
//                
//                var count = 0
//                for button in shownButtons {
//                    button.addTarget(self, action: #selector(tappedButton(sender:)), for: .touchUpInside)
//                    button.tag = count
//                    count += 1
//                }
//            }
//    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    

    
    func animateButtonsMovingUp() {
 
        
        for constraint in shownButtonsCenterYConstraints {
            constraint.constant = 16
        }

        for button in self.shownButtons {
            button.alpha = 0
        }
        
        var count = 0
        
        var timer = Timer()
        
        var moveUpSpeed: TimeInterval = 0.5
        if shownButtons.count > 5 {
            moveUpSpeed = 0.25
        }
        
         timer = Timer.scheduledTimer(withTimeInterval: 0.2, repeats: true) { (view) in
      

        UIView.animate(withDuration: moveUpSpeed) {

            if self.shownButtons.isEmpty == false {
            if self.buttonTapped == false { // This fades the buttons afer a button has been tapped while it's presenting the buttons
                
            self.shownButtons[count].alpha = 1.0
            } else {
                self.shownButtons[count].alpha = 0.5

            }
                
            if count < self.shownButtonsCenterYConstraints.count {
                self.shownButtonsCenterYConstraints[count].constant = 0
            }

            self.layoutIfNeeded()
            }
        }
            
            if count == self.shownButtons.count - 1 {
                timer.invalidate()
            }
            count += 1

        }
    }
    
    


    
    private func getAllButtons() -> [UIButton] {
        return  [row1Button1, row1Button2, row1Button3, row1Button4, row2Button1, row2Button2, row2Button3, row2Button4, row3Button1,row3Button2, row3Button3, row3Button4, row4Button4, row4Button3, row4Button2, row4Button1, row5Button1, row5Button2, row5Button3, row5Button4, row6Button1, row6Button2, row6Button3, row6Button4, row7Button1, row7Button2, row7Button3, row7Button4, row8Button1, row8Button2, row8Button3, row8Button4]

    }
    
    private func getRow1CenterConstraints() -> [NSLayoutConstraint] {
        return [row1Button1Center, row1Button2Center, row1Button3Center, row1Button4Center]
    }
    private func getRow2CenterConstraints() -> [NSLayoutConstraint] {
        return [row2Button1Center, row2Button2Center, row2Button3Center, row2Button4Center]
    }
    private func getRow3CenterConstraints() -> [NSLayoutConstraint] {
        return [row3Button1Center, row3Button2Center, row3Button3Center, row3Button4Center]
    }
    
    private func getRow4CenterConstraints() -> [NSLayoutConstraint]{
        return [row4Button1Center, row4Button2Center, row4Button3Center, row4Button4Center]
    }
    
    private func getRow5CenterConstraints() -> [NSLayoutConstraint] {
        return [row5Button1Center, row5Button2Center, row5Button3Center, row5Button4Center]
    }
    private func getRow6CenterConstraints() -> [NSLayoutConstraint] {
        return [row6Button1Center, row6Button2Center, row6Button3Center, row6Button4Center]
    }
    private func getRow7CenterConstraints() -> [NSLayoutConstraint] {
        return [row7Button1Center, row7Button2Center, row7Button3Center, row7Button4Center]
    }
    private func getRow8CenterConstraints() -> [NSLayoutConstraint] {
        return [row8Button1Center, Row8Button2Center, row8Button3Center, row8Button4Center]
    }
    
    
   
    private func calculateWidthOfButtonFor(title: String)-> CGFloat {
        var width = widthOfString(string: title)
        if width < 60 {
            width = 60
        }
        width += 16
        
        let maxWidth = spacerView.frame.width - 32
        if width > maxWidth {
            width = maxWidth
        }
        return width
    }
    private func widthOfString(string: String) -> CGFloat {
        let fontAttributes = [NSAttributedStringKey.font: UIFont.systemFont(ofSize: 16, weight: UIFont.Weight.bold)]
        let size = string.size(withAttributes: fontAttributes)
        return size.width
    }
    
 
    
    func changeAlphaOfButtons(indexOfTapped: Int) {
        for button in shownButtons {
            if button.tag != indexOfTapped {
                UIView.animate(withDuration: 0.5, animations: {
                    
                    if  self.shownButtons[button.tag].backgroundColor == getColourFor.appColour() {
                        
                        button.alpha = 0.5
                    }
                })
            } else {
                UIView.animate(withDuration: 0.5, animations: {
                    self.shownButtons[indexOfTapped].alpha = 1.0
                })
            }
        }
    }
    
//    @objc func tappedButton(sender: UIButton) {
//       // let view = sender.titleLabel?.text //.view //as! UIButton
//        buttonTapped = true
//
//        chatManager.pendingQueue = []
//
//        chatManager.currentPromptType = currentPromptType
//
//        triageAction(action: buttons[sender.tag].action, userInput: buttons[sender.tag].title)
//
//        if chatManager.currentVC == .home {
//            NotificationCenter.default.post(name: NSNotification.Name(rawValue: "switchToChatVC"), object: nil)
//        } //else if chatManager.currentVC == .chat {
////            chatManager.buttonTappedPositionInItemsShown = positionInItemsShown
////            chatManager.buttonTappedIndex = sender.tag
////                  NotificationCenter.default.post(name: NSNotification.Name(rawValue: "buttonTapped"), object: nil)
////        }
//
//    }
    
    func moveButtonsToUnderUserMessage(animate: Bool) {
      row1CenterX.isActive = false
        row2CenterX.isActive = false
        row3CenterX.isActive = false
        row4CenterX.isActive = false
        row5CenterX.isActive = false
        row6CenterX.isActive = false
        row7CenterX.isActive = false
        row8CenterX.isActive = false

        let yConstraints = [row2CenterY, row3CenterY, row4CenterY, row5CenterY, row6CenterY, row7CenterY, row8CenterY]
        for constraint in yConstraints {
            constraint?.constant = 0
        }
   
        
        reduceWidthOfAllButtonsToZero()
        var time = 0.5
        if animate == false {
            time = 0.0
        }
        UIView.animate(withDuration: time) {
            self.layoutIfNeeded()
            for button in self.shownButtons {
                button.alpha = 0.0
            }

        }
        
    }

    func animateTappedButtonToUserMessage() {
        displayUser(message: "test", animate: true)

        moveButtonsToUnderUserMessage(animate: true)
    }
    func displayUser(message: String, animate: Bool) {
        self.userMessageBackground.alpha = 0
        self.userMessageBackground.isHidden = false
        self.userMessageLabel.text = message
        
        var time = 0.0
        if animate {
            time = 1.0
        }
        UIView.animate(withDuration: time) {
            self.userMessageBackground.alpha = 1.0
          
    }
    }
    
    
    func animateUserMessageToButtonCloud() {
        
        // Move rows back to center
        //alpha of buttons to 1
        // increase width of buttons
        
        
        
        var widths: [CGFloat] = []
        var widthsPerLine: [[CGFloat]] = [[],[],[],[], [],[], [], []]
        
        
        let titles = getButtonTitles()
        // Gets widths for titles of buttons
        for title in titles {
            widths.append(calculateWidthOfButtonFor(title: title))
        }
        
        widthsPerLine = figureOutWhichLineButtonsWillBeOn(widths: widths)
        moveRowsCenterY(widthsPerLine: widthsPerLine)
        createButtons(widthsPerLine: widthsPerLine, titles: titles)
        
        
//        let xConstraints = [row1CenterX, row2CenterX, row3CenterX, row4CenterX, row5CenterX, row6CenterX, row7CenterX, row8CenterX]
//        for constraint in xConstraints {
//            constraint?.isActive = true
//        }
        
//        row1CenterX.
        centerRowsInScreen()
        
//        let yConstraints = [row2CenterY, row3CenterY, row4CenterY, row5CenterY, row6CenterY, row7CenterY, row8CenterY]
//
//
//        var count: CGFloat = 1
//        for constraint in yConstraints {
//            constraint?.constant = count * 44
//            count += 1
//        }

        
        
        

        
        UIView.animate(withDuration: 0.5) {
            self.layoutIfNeeded()
            for button in self.shownButtons {
                button.alpha = 1.0
            }
        }
        
    }
    
    
    func centerRowsInScreen() {
                row1CenterX = NSLayoutConstraint(item: row1, attribute: .centerX,
                                                 relatedBy: .equal, toItem: spacerView, attribute: .centerX,
                                                multiplier: 1, constant: 0)
                row1CenterX.isActive = true
        
                row2CenterX = NSLayoutConstraint(item: row2, attribute: .centerX,
                                                 relatedBy: .equal, toItem: spacerView, attribute: .centerX,
                                                 multiplier: 1, constant: 0)
                row2CenterX.isActive = true
        
        
                row3CenterX = NSLayoutConstraint(item: row3, attribute: .centerX,
                                                 relatedBy: .equal, toItem: spacerView, attribute: .centerX,
                                                 multiplier: 1, constant: 0)
                row3CenterX.isActive = true
        
        
                row4CenterX = NSLayoutConstraint(item: row4, attribute: .centerX,
                                                 relatedBy: .equal, toItem: spacerView, attribute: .centerX,
                                                 multiplier: 1, constant: 0)
                row4CenterX.isActive = true
        
                row5CenterX = NSLayoutConstraint(item: row5, attribute: .centerX,
                                                 relatedBy: .equal, toItem: spacerView, attribute: .centerX,
                                                 multiplier: 1, constant: 0)
                row5CenterX.isActive = true
        
                row6CenterX = NSLayoutConstraint(item: row6, attribute: .centerX,
                                                 relatedBy: .equal, toItem: spacerView, attribute: .centerX,
                                                 multiplier: 1, constant: 0)
                row6CenterX.isActive = true
        
                row7CenterX = NSLayoutConstraint(item: row7, attribute: .centerX,
                                                 relatedBy: .equal, toItem: spacerView, attribute: .centerX,
                                                 multiplier: 1, constant: 0)
                row7CenterX.isActive = true
                row8CenterX = NSLayoutConstraint(item: row8, attribute: .centerX,
                                                 relatedBy: .equal, toItem: spacerView, attribute: .centerX,
                                                 multiplier: 1, constant: 0)
                row8CenterX.isActive = true
    }
    
    
    
    func displayInUserMessageMode(animate: Bool) {
        userMessageBackground.isHidden = false
        userMessageLabel.text = messageText
        moveButtonsToUnderUserMessage(animate: animate)
        displayUser(message: messageText, animate: animate)
        
    }
    
 
    
    
}// End of class


// TODO: Make this function move the unused row to be equal with the last used row
//            removeUnusedRows(widthsPerLine: widthsPerLine)


struct ButtonData {
    var title = String()
    var action: ButtonAction = .none
    var global: Bool = false
    var premium: Bool = false
    
}
